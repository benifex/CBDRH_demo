---
title: "CBDRH_demo"
author: "A.T. du Toit"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(magrittr)
library(knitr)
library(kableExtra)
library(janitor)
library(caroline)

mk <- function(x) {
    kable(x) %>% kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
}

```

```{r Create: dummy data}
dummy_data1 <- data.frame(
  PAT_ID = c(1:56),
  PARENT_SEX = c(rep(1, 46), rep(2,8), rep(3,2))
  )

# create and randomise some vectors for use in data frame
n_v_egth1 <- c(rep(0, 53), rep(1, 36))
n_v_egth1 <- sample(n_v_egth1)
n_v_egth1 <- c(n_v_egth1, rep(NA, 2))

n_v_egth2 <- c(rep(0, 10), rep(1, 2))
n_v_egth2 <- sample(n_v_egth2)
n_v_egth2 <- c(n_v_egth2, rep(NA, 1))

n_v_egth3 <- c(rep(0, 2), rep(1, 1))
n_v_egth3 <- sample(n_v_egth3)
n_v_egth3 <- c(n_v_egth3, rep(NA, 1))

n_v_egth <- c(n_v_egth1, n_v_egth2, n_v_egth3)
  
dummy_data2 <- data.frame(
  PAT_ID = c(1:18, rep(19:34,each=2), rep(35:41, each=3), rep(42:46, each=4), 
             47:50, rep(51:53, each=2), rep(54, each=3),
             rep(55:56, each=2)),
  CYCLE_ID = c(1:108), 
  CYCLE_TYPE = c(rep(1,89), 4, 5, rep(1, 12), 4, rep(1, 3), 5),   
  N_V_EGTH = c(n_v_egth)
      )

dummy_data <- right_join(dummy_data1, dummy_data2, by = "PAT_ID")

rm(dummy_data1, dummy_data2)
```

```{r Create: example table}
tab2 <- dummy_data %>% tabyl(PARENT_SEX, N_V_EGTH) %>% 
  adorn_totals(c("col"))

# tab2 %<>% 
#   mutate(`0_pct` = `0` / last(`0`), .after = `0`) %>% 
#   mutate(`1_pct` = `1` / last(`1`), .after = `1`) %>% 
#   mutate(`NA_pct` = `NA_` / last(`NA_`), .after = `NA_`) %>% 
#   mutate(Total_pct = Total / last(Total), .after = `Total`)

tab2 %<>%  pct(c("0", "1", "NA_", "Total"))

tab2 %<>% adorn_totals("row") 

tab2 %<>% select(PARENT_SEX, "0", "0.pct", "1", "1.pct", "NA_", "NA_.pct", Total, Total.pct)

tab2 %<>% adorn_pct_formatting(,,,`0.pct`, `1.pct`, `NA_.pct`, Total.pct)

tab2 %>% 
  mutate(PARENT_SEX = case_when(PARENT_SEX == "1" ~ "Female-male couple",
      PARENT_SEX == "2" ~ "Single female",
      PARENT_SEX == "3" ~ "Female-female couple",
       .default = as.character(PARENT_SEX))) %>%
   kable(col.names = c("Intending parents", "n", "%", "n", "%","n", "%","n", "%"),
         align = "lrrrrrrrr") %>%
   kable_styling(htmltable_class = "lightable-classic-2") %>% 
  row_spec(4, bold = T) %>% 
  add_header_above(c(" "=1, "Fresh"=2, "Thawed"=2, "Oocyte/Embryo \n recipient"=2, "All"=2), align = "c") %>% 
  add_header_above(c(" "=1, "Autologous"=4, " "=4)) %>% 
  add_header_above(c("Table 2: Number of autologous and recipient cycles by intending parents and treatment type, Australia and New Zealand, 2021"=9), bold = TRUE, align = "l")

```

```{r Create: function for example table}


```

```{r Create: example table using function}


```


